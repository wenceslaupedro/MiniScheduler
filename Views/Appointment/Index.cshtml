@{
	ViewData["Title"] = "Appointments";
}

<a href="https://www.flaticon.com/free-icons/calendar" title="calendar icon">Calender</a>

<div class="d-flex justify-content-between align-items-center mb-3">
	<h1>Appointments</h1>
	<a class="btn btn-primary" asp-controller="Appointment" asp-action="Create">Book Appointment</a>
</div>

<div id="calendar"></div>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/locales-all.global.min.js"></script>

<style>
	#calendar { max-width: 100%; margin: 0 auto; font-size: 0.9rem; }
	.fc .fc-toolbar.fc-header-toolbar { margin-bottom: 0.5rem; }
	.fc .fc-daygrid-day-number { padding: 0.2rem; }
	.fc .fc-daygrid-event { font-size: 0.8rem; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
	const calendarEl = document.getElementById('calendar');
	const calendar = new FullCalendar.Calendar(calendarEl, {
		initialView: 'dayGridMonth',
		height: 'auto',
		contentHeight: 'auto',
		expandRows: true,
		aspectRatio: 1.2,
		locale: 'en-gb',
		buttonText: { today: 'Today', month: 'Month', week: 'Week', day: 'Day', list: 'List' },
		headerToolbar: {
			left: 'prev,next today',
			center: 'title',
			right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
		},
		navLinks: true,
		nowIndicator: true,
		dayMaxEventRows: 24,
		dayHeaderFormat: { day: '2-digit', month: '2-digit', weekday: 'short' },
		events: {
			url: '@Url.Action("Events", "Appointment")',
			failure: () => alert('Failed to load events')
		},
		dateClick: function (info) {
			// Prefill Create with clicked date/time (local -> query)
			const dt = new Date(info.dateStr);
			const iso = dt.toISOString();
			window.location.href = '@Url.Action("Create", "Appointment")' + '?date=' + encodeURIComponent(iso);
		},
		eventClick: function (info) {
			// Navigate to delete confirmation
			window.location.href = '@Url.Action("Delete", "Appointment")' + '/' + info.event.id;
		}
	});
	calendar.render();
});
</script>


